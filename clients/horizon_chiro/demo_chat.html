<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LeadFlowHQ Demo Assistant</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      color: #e5e7eb;
    }

    .chat-container {
      width: 380px;
      max-width: 95vw;
      height: 520px;
      background: #020617;
      border-radius: 18px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border: 1px solid #1f2937;
    }

    .chat-header {
      padding: 14px 16px;
      background: linear-gradient(135deg, #14b8a6, #6366f1);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .avatar {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: rgba(15,23,42,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 16px;
      color: #e5e7eb;
    }

    .chat-header-text {
      display: flex;
      flex-direction: column;
    }

    .chat-header-title {
      font-size: 14px;
      font-weight: 600;
    }

    .chat-header-subtitle {
      font-size: 11px;
      opacity: 0.9;
    }

    .chat-messages {
      flex: 1;
      padding: 12px;
      overflow-y: auto;
      background: radial-gradient(circle at top, rgba(148,163,184,0.18), transparent 60%);
    }

    .message-row {
      display: flex;
      margin-bottom: 8px;
    }

    .message-row.user {
      justify-content: flex-end;
    }

    .bubble {
      max-width: 80%;
      padding: 8px 10px;
      border-radius: 14px;
      font-size: 13px;
      line-height: 1.3;
    }

    .bubble.user {
      background: #4f46e5;
      color: white;
      border-bottom-right-radius: 4px;
    }

    .bubble.bot {
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #1f2937;
      border-bottom-left-radius: 4px;
    }

    .chat-input-area {
      padding: 10px;
      border-top: 1px solid #1f2937;
      background: #020617;
      display: flex;
      gap: 8px;
    }

    .chat-input {
      flex: 1;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 13px;
      outline: none;
    }

    .chat-input::placeholder {
      color: #6b7280;
    }

    .send-btn {
      border-radius: 999px;
      border: none;
      padding: 0 14px;
      font-size: 13px;
      cursor: pointer;
      background: #4f46e5;
      color: white;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .send-btn:active {
      transform: translateY(1px);
    }

    .helper-bar {
      font-size: 10px;
      opacity: 0.85;
      padding: 6px 10px;
      border-top: 1px solid #111827;
      background: #020617;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .helper-text {
      font-size: 10px;
      opacity: 0.9;
    }

    .lead-btn {
      border-radius: 999px;
      border: 1px solid #4f46e5;
      background: #111827;
      color: #e5e7eb;
      font-size: 10px;
      padding: 4px 10px;
      cursor: pointer;
      white-space: nowrap;
    }

    .lead-btn:active {
      transform: translateY(1px);
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <div class="avatar">AI</div>
      <div class="chat-header-text">
<div class="chat-header-title">LeadFlowHQ Demo Assistant</div>
<div class="chat-header-subtitle">Horizon Chiropractic ‚Ä¢ Smart website chat</div>
      </div>
    </div>

    <div class="chat-messages" id="messages">
      <div class="message-row bot">
      <div class="bubble bot">
  Hi! I‚Äôm your AI assistant for Horizon Chiropractic üëã<br />
  I can answer questions about hours, services, and chiropractic care ‚Äî and I can also take your details so the team can call or email you back.<br /><br />
  You can ask a question, or click <strong>‚ÄúRequest a call‚Äù</strong> below.
</div>
      </div>
    </div>

    <div class="helper-bar">
      <div class="helper-text">
        Demo only ‚Äì this is what your LeadFlowHQ widget could look like.
      </div>
      <button id="leadBtn" class="lead-btn">Request a call</button>
    </div>

    <div class="chat-input-area">
      <input id="chatInput" class="chat-input" type="text" placeholder="Type a message and press Enter..." />
      <button id="sendBtn" class="send-btn">Send</button>
    </div>
  </div>

  <script>
    const messagesEl = document.getElementById("messages");
    const inputEl = document.getElementById("chatInput");
    const sendBtn = document.getElementById("sendBtn");
    const leadBtn = document.getElementById("leadBtn");

    let hasLead = false;

    function shouldStartLeadFlow(lower) {
      const intentVerbs = ["make", "schedule", "book", "set up", "set one up", "arrange", "reschedule", "move my", "change my", "cancel my", "cancel an"];
      const appointmentWords = ["appointment", "appt", "appts", "cleaning", "consultation", "checkup", "visit"];

      const wantsInfoPhrases = [
        "take my info", "take my information", "leave my info", "leave info",
        "give you my info", "give u my info", "give my info",
        "have someone call", "have somebody call", "have the office call",
        "call me back", "call me about this", "call me please",
        "can someone call me", "can somebody call me",
      ];

      if (wantsInfoPhrases.some((p) => lower.includes(p))) return true;

      const hasVerb = intentVerbs.some((v) => lower.includes(v));
      const hasApptWord = appointmentWords.some((w) => lower.includes(w));

      return hasVerb && hasApptWord;
    }

    let leadMode = "idle";
    let leadDraft = { name: "", email: "", message: "" };

    function addMessage(text, sender = "bot") {
      const row = document.createElement("div");
      row.className = "message-row " + sender;

      const bubble = document.createElement("div");
      bubble.className = "bubble " + sender;
      bubble.innerHTML = text.replace(/\n/g, "<br />");

      row.appendChild(bubble);
      messagesEl.appendChild(row);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    async function sendToBackend(userText) {
      const typingRow = document.createElement("div");
      typingRow.className = "message-row bot";
      const typingBubble = document.createElement("div");
      typingBubble.className = "bubble bot";
      typingBubble.textContent = "Thinking...";
      typingRow.appendChild(typingBubble);
      messagesEl.appendChild(typingRow);
      messagesEl.scrollTop = messagesEl.scrollHeight;

      try {
const response = await fetch("https://second-client-test-production.up.railway.app/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: userText })
        });

        messagesEl.removeChild(typingRow);

        const data = await response.json();
        const reply = data.reply || "No reply from backend.";

        if (reply === "__TRIGGER_LEAD_FLOW__") {
          if (hasLead) {
            addMessage("I already have your contact details on file. If something has changed, just tell me what‚Äôs new and I‚Äôll pass it along.", "bot");
          } else {
            startLeadFlow();
          }
          return;
        }

        addMessage(reply, "bot");
      } catch (err) {
        messagesEl.removeChild(typingRow);
        addMessage("Error connecting to backend.", "bot");
      }
    }

    async function sendLeadToBackend(lead) {
      try {
const res = await fetch("https://second-client-test-production.up.railway.app/lead", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(lead)
        });

        hasLead = true;
        addMessage("Got it ‚Äî we‚Äôve sent your details to the office. They‚Äôll reach out as soon as possible. üìû", "bot");
      } catch {
        addMessage("There was an issue sending your details. Please call the office directly.", "bot");
      }
    }

    function startLeadFlow() {
      if (hasLead) {
        addMessage("I already have your contact details saved. If you just have a question, go ahead and ask it here üòä", "bot");
        return;
      }

      leadDraft = { name: "", email: "", message: "" };
      leadMode = "collect_name";

      addMessage("Sure ‚Äî I can take a few details so the office can reach out to you. If you'd rather not share info, you can type ‚Äúskip‚Äù any time.", "bot");
      addMessage("First, what‚Äôs your name?", "bot");
    }

    function handleSend() {
      const text = inputEl.value.trim();
      if (!text) return;

      addMessage(text, "user");
      inputEl.value = "";

      const lower = text.toLowerCase();

      if (leadMode !== "idle" && lower.includes("skip")) {
        addMessage("No worries ‚Äî we won‚Äôt collect any more details.", "bot");
        leadMode = "idle";
        return;
      }

      if (leadMode === "collect_name") {
        leadDraft.name = text;
        leadMode = "collect_email";
        addMessage(`Nice to meet you, ${leadDraft.name}! What‚Äôs the best email to reach you?`, "bot");
        return;
      }

      if (leadMode === "collect_email") {
        leadDraft.email = text;
        leadMode = "collect_msg";
        addMessage("Got it ‚Äî lastly, what is this about?", "bot");
        return;
      }

      if (leadMode === "collect_msg") {
        leadDraft.message = text;
        addMessage("Thanks! I‚Äôm sending your details to the office now‚Ä¶", "bot");
        sendLeadToBackend(leadDraft);
        leadMode = "idle";
        return;
      }

      if (shouldStartLeadFlow(lower)) {
        startLeadFlow();
        return;
      }

      sendToBackend(text);
    }

    sendBtn.addEventListener("click", handleSend);
    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        handleSend();
      }
    });

    leadBtn.addEventListener("click", startLeadFlow);
  </script>
</body>
</html>