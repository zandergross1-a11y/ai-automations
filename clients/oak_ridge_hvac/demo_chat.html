<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
<title>LeadFlowHQ Assistant ‚Ä¢ Oak Ridge HVAC</title>
  <style>
    :root {
      --lf-bg: #ffffff;              /* widget card background */
      --lf-surface: #f9fafb;         /* chat area surface */
      --lf-border: #e5e7eb;
      --lf-accent: #0ea5e9;          /* main accent (aqua) */
      --lf-accent-soft: rgba(14, 165, 233, 0.14);

      --lf-text: #0f172a;            /* dark text */
      --lf-muted: #6b7280;           /* softer text */
      --lf-danger: #f97373;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      /* Soft gradient ‚Äúwebsite‚Äù background */
      background: linear-gradient(180deg, #eef2ff 0%, #e0f2fe 40%, #f9fafb 100%);
      color: var(--lf-text);
      height: 100vh;
      overflow: hidden;
    }

    /* Floating launcher button */
    .lf-launcher {
      position: fixed;
      right: 20px;
      bottom: 20px;
      z-index: 9999;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, var(--lf-accent), #38bdf8);
      color: white;
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.6);
      font-size: 13px;
      font-weight: 500;
    }

    .lf-launcher-avatar {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
    }

    /* Chat container (floating card) */
    .chat-container {
      position: fixed;
      right: 20px;
      bottom: 80px;
      width: 380px;
      max-width: 92vw;
      height: 520px;
      max-height: 80vh;

      background: var(--lf-bg);
      border-radius: 20px;
      box-shadow: 0 24px 60px rgba(15, 23, 42, 0.25);
      display: none; /* opened by launcher */
      flex-direction: column;
      overflow: hidden;
      border: 1px solid var(--lf-border);
      z-index: 9999;
      animation: lf-pop 0.18s ease-out;
    }

    @keyframes lf-pop {
      from {
        transform: translateY(12px) scale(0.96);
        opacity: 0;
      }
      to {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }

    .chat-header {
      padding: 12px 14px;
      background: linear-gradient(135deg, var(--lf-accent), #38bdf8);
      display: flex;
      align-items: center;
      gap: 10px;
      color: #f9fafb;
    }

    .avatar {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.28);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 16px;
    }

    .chat-header-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .chat-header-title {
      font-size: 14px;
      font-weight: 600;
    }

    .chat-header-subtitle {
      font-size: 11px;
      opacity: 0.92;
    }

    .chat-header-status {
      font-size: 10px;
      opacity: 0.85;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.28);
    }

    .chat-close {
      margin-left: auto;
      background: transparent;
      border: none;
      color: #e5e7eb;
      cursor: pointer;
      font-size: 14px;
      opacity: 0.9;
    }

    .chat-messages {
      flex: 1;
      padding: 10px;
      overflow-y: auto;
      font-size: 13px;
      background: var(--lf-surface);
    }

    .message-row {
      display: flex;
      margin-bottom: 8px;
    }

    .message-row.user {
      justify-content: flex-end;
    }

    .bubble {
      max-width: 80%;
      padding: 8px 10px;
      border-radius: 14px;
      line-height: 1.35;
    }

    .bubble.user {
      background: linear-gradient(135deg, var(--lf-accent), #38bdf8);
      color: white;
      border-bottom-right-radius: 4px;
    }

    .bubble.bot {
      background: #ffffff;
      color: var(--lf-text);
      border: 1px solid var(--lf-border);
      border-bottom-left-radius: 4px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.06);
    }

    .bubble.system {
      font-size: 12px;
      color: var(--lf-muted);
      background: rgba(15, 23, 42, 0.04);
      border-radius: 999px;
      padding: 4px 10px;
      margin: 4px auto 10px auto;
      text-align: center;
    }

    .chat-input-area {
      padding: 8px 10px;
      border-top: 1px solid var(--lf-border);
      background: #ffffff;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .helper-bar {
      font-size: 10px;
      opacity: 0.9;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .helper-text {
      font-size: 10px;
      color: var(--lf-muted);
    }

    .lead-btn {
      border-radius: 999px;
      border: 1px solid var(--lf-accent);
      background: var(--lf-accent-soft);
      color: #0f172a;
      font-size: 10px;
      padding: 4px 10px;
      cursor: pointer;
      white-space: nowrap;
    }

    .lead-btn:active {
      transform: translateY(1px);
    }

    .input-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .chat-input {
      flex: 1;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--lf-border);
      background: #f9fafb;
      color: var(--lf-text);
      font-size: 13px;
      outline: none;
    }

    .chat-input::placeholder {
      color: #6b7280;
    }

    .send-btn {
      border-radius: 999px;
      border: none;
      padding: 0 14px;
      font-size: 13px;
      cursor: pointer;
      background: var(--lf-accent);
      color: white;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 32px;
    }

    .send-btn:active {
      transform: translateY(1px);
    }

    .error-text {
      font-size: 10px;
      color: var(--lf-danger);
      margin-top: 2px;
    }

    @media (max-width: 600px) {
      .chat-container {
        right: 10px;
        left: 10px;
        width: auto;
        bottom: 90px;
        max-height: 75vh;
      }

      .lf-launcher {
        right: 16px;
        bottom: 16px;
      }
    }
  </style>
</head>
<body>
  <!-- Launcher Button -->
  <button id="lf-launcher" class="lf-launcher">
    <div class="lf-launcher-avatar">AI</div>
    <span>Need help?</span>
  </button>

  <!-- Chat Widget -->
  <div class="chat-container" id="chatContainer">
    <div class="chat-header">
      <div class="avatar">AI</div>
      <div class="chat-header-text">
        <div class="chat-header-title">LeadFlowHQ Assistant</div>
        <!-- EDIT THIS PER CLIENT -->
        <div class="chat-header-subtitle">
          Summit Family Dental ‚Ä¢ Smart website chat
        </div>
        <div class="chat-header-status">
          <span class="status-dot"></span>
          <span>Online ‚Ä¢ typically replies in seconds</span>
        </div>
      </div>
      <button id="chatClose" class="chat-close" aria-label="Close chat">‚úï</button>
    </div>

    <div class="chat-messages" id="messages">
      <div class="message-row bot">
        <div class="bubble bot" id="initialBubble">
          <!-- This gets overwritten by JS using CONFIG.businessName -->
          Hi! I‚Äôm your AI assistant üëã
        </div>
      </div>
      <div class="bubble system" id="systemBubble">
        Demo only ‚Äì this is what your LeadFlowHQ widget could look like.
      </div>
    </div>

    <div class="chat-input-area">
      <div class="helper-bar">
        <div class="helper-text" id="helperText">
          Ask about hours, services, or pricing ‚Äî or let us collect your details for a call back.
        </div>
        <button id="leadBtn" class="lead-btn">Request a call</button>
      </div>

      <div class="input-row">
        <input
          id="chatInput"
          class="chat-input"
          type="text"
          placeholder="Type a message and press Enter..."
        />
        <button id="sendBtn" class="send-btn">Send</button>
      </div>
      <div id="errorText" class="error-text" style="display:none;"></div>
    </div>
  </div>

  <script>
// ===== SIMPLE PER-CLIENT CONFIG (Option 1) =====
const CONFIG = {
  // EDIT THIS PER CLIENT ‚Üì‚Üì‚Üì
  businessName: "Oak Ridge HVAC",
  industryLine: "heating, cooling, and HVAC services",
  helperLine: "Ask about service, availability, or pricing ‚Äî or let us collect your details for a call back.",
  baseUrl: "oak-hvac-production.up.railway.app",
};

    const launcherEl = document.getElementById("lf-launcher");
    const chatContainer = document.getElementById("chatContainer");
    const closeEl = document.getElementById("chatClose");
    const messagesEl = document.getElementById("messages");
    const inputEl = document.getElementById("chatInput");
    const sendBtn = document.getElementById("sendBtn");
    const leadBtn = document.getElementById("leadBtn");
    const errorTextEl = document.getElementById("errorText");
    const initialBubbleEl = document.getElementById("initialBubble");
    const helperTextEl = document.getElementById("helperText");

    // Initialize text based on CONFIG
    initialBubbleEl.innerHTML =
      `Hi! I‚Äôm your AI assistant for <strong>${CONFIG.businessName}</strong> üëã<br />` +
      `I can answer questions about ${CONFIG.industryLine} ‚Äî and I can also take your details so the team can call you back.<br /><br />` +
      `You can ask a question, or click <strong>‚ÄúRequest a call‚Äù</strong> below.`;

    helperTextEl.textContent = CONFIG.helperLine;

    let hasLead = false;

    function shouldStartLeadFlow(lower) {
      const intentVerbs = [
        "make",
        "schedule",
        "book",
        "set up",
        "set one up",
        "arrange",
        "reschedule",
        "move my",
        "change my",
        "cancel my",
        "cancel an",
      ];
      const appointmentWords = [
        "appointment",
        "appt",
        "appts",
        "cleaning",
        "consultation",
        "checkup",
        "visit",
        "chiropractic",
        "adjustment",
      ];
      const wantsInfoPhrases = [
        "take my info",
        "take my information",
        "leave my info",
        "leave info",
        "give you my info",
        "give u my info",
        "give my info",
        "have someone call",
        "have somebody call",
        "have the office call",
        "call me back",
        "call me about this",
        "call me please",
        "can someone call me",
        "can somebody call me",
      ];

      if (wantsInfoPhrases.some((p) => lower.includes(p))) return true;

      const hasVerb = intentVerbs.some((v) => lower.includes(v));
      const hasApptWord = appointmentWords.some((w) => lower.includes(w));
      return hasVerb && hasApptWord;
    }

    let leadMode = "idle";
    let leadDraft = { name: "", phone: "", message: "" };

    function addMessage(text, sender = "bot") {
      const row = document.createElement("div");
      row.className = "message-row " + sender;

      const bubble = document.createElement("div");
      bubble.className = "bubble " + sender;
      bubble.innerHTML = text.replace(/\n/g, "<br />");

      row.appendChild(bubble);
      messagesEl.appendChild(row);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function showError(msg) {
      errorTextEl.textContent = msg;
      errorTextEl.style.display = "block";
      setTimeout(() => {
        errorTextEl.style.display = "none";
      }, 4000);
    }

    async function sendToBackend(userText) {
      const typingRow = document.createElement("div");
      typingRow.className = "message-row bot";
      const typingBubble = document.createElement("div");
      typingBubble.className = "bubble bot";
      typingBubble.textContent = "Thinking...";
      typingRow.appendChild(typingBubble);
      messagesEl.appendChild(typingRow);
      messagesEl.scrollTop = messagesEl.scrollHeight;

      try {
        const response = await fetch(`${CONFIG.baseUrl}/chat`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: userText }),
        });

        messagesEl.removeChild(typingRow);

        if (!response.ok) {
          showError("There was a problem reaching the assistant.");
          addMessage("Sorry ‚Äî I‚Äôm having trouble connecting right now. Please try again in a moment.", "bot");
          return;
        }

        const data = await response.json();
        const reply = data.reply || "No reply from backend.";

        if (reply === "__TRIGGER_LEAD_FLOW__") {
          if (hasLead) {
            addMessage(
              "I already have your contact details on file. If something has changed, just tell me what‚Äôs new and I‚Äôll pass it along.",
              "bot"
            );
          } else {
            startLeadFlow();
          }
          return;
        }

        addMessage(reply, "bot");
      } catch (err) {
        messagesEl.removeChild(typingRow);
        showError("Error connecting to assistant.");
        addMessage(
          "Sorry ‚Äî I couldn‚Äôt reach the assistant. Please try again or contact the office directly.",
          "bot"
        );
      }
    }

    async function sendLeadToBackend(lead) {
      try {
        const res = await fetch(`${CONFIG.baseUrl}/lead`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(lead),
        });

        if (!res.ok) {
          showError("There was an issue sending your details.");
          addMessage(
            "There was an issue sending your details. Please call the office directly so they don‚Äôt miss you.",
            "bot"
          );
          return;
        }

        hasLead = true;
        addMessage("Got it ‚Äî we‚Äôve sent your details to the office. They‚Äôll reach out as soon as possible. üìû", "bot");
      } catch (err) {
        showError("There was an issue sending your details.");
        addMessage(
          "There was an issue sending your details. Please call the office directly so they don‚Äôt miss you.",
          "bot"
        );
      }
    }

    function startLeadFlow() {
      if (hasLead) {
        addMessage(
          "I already have your contact details saved. If you just have a question, go ahead and ask it here üòä",
          "bot"
        );
        return;
      }

      leadDraft = { name: "", phone: "", message: "" };
      leadMode = "collect_name";

      addMessage(
        "Sure ‚Äî I can take a few details so the office can reach out to you. If you'd rather not share info, you can type ‚Äúskip‚Äù any time.",
        "bot"
      );
      addMessage("First, what‚Äôs your name?", "bot");
    }

    function handleSend() {
      const text = inputEl.value.trim();
      if (!text) return;

      addMessage(text, "user");
      inputEl.value = "";
      inputEl.focus();

      const lower = text.toLowerCase();

      if (leadMode !== "idle" && lower.includes("skip")) {
        addMessage(
          "No worries ‚Äî we won‚Äôt collect any more details. You can still ask me about hours, services, or pricing.",
          "bot"
        );
        leadMode = "idle";
        leadDraft = { name: "", phone: "", message: "" };
        return;
      }

      if (leadMode === "collect_name") {
        leadDraft.name = text;
        leadMode = "collect_phone";
        addMessage(`Nice to meet you, ${leadDraft.name}! What‚Äôs the best phone number to reach you?`, "bot");
        return;
      }

      if (leadMode === "collect_phone") {
        leadDraft.phone = text;
        leadMode = "collect_msg";
        addMessage(
          "Got it ‚Äî lastly, what is this about? (for example: appointment, pain, insurance, or a general question)",
          "bot"
        );
        return;
      }

      if (leadMode === "collect_msg") {
        leadDraft.message = text;
        addMessage("Thanks! I‚Äôm sending your details to the office now‚Ä¶", "bot");
        sendLeadToBackend(leadDraft);
        leadMode = "idle";
        leadDraft = { name: "", phone: "", message: "" };
        return;
      }

      if (shouldStartLeadFlow(lower)) {
        startLeadFlow();
        return;
      }

      sendToBackend(text);
    }

    sendBtn.addEventListener("click", handleSend);
    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        handleSend();
      }
    });

    leadBtn.addEventListener("click", startLeadFlow);

    launcherEl.addEventListener("click", () => {
      const isOpen = chatContainer.style.display === "flex";
      if (isOpen) {
        chatContainer.style.display = "none";
      } else {
        chatContainer.style.display = "flex";
        inputEl.focus();
      }
    });

    closeEl.addEventListener("click", () => {
      chatContainer.style.display = "none";
    });
  </script>
</body>
</html>